---
title: "The Economy is a Heat Engine (Mostly)"
date: 2025-04-22T07:57:05-04:00
draft: false
tags:
- economics
- heat engine
- win-win
- win-lose
- lose-lose
- thermodynamics
- emergence
---

Economics is a strange beast. We treat it like a hard science, expecting precise predictions, but it often feels more like math stirred together with psychology, constantly trying to explain the past rather than foreseeing the future. If economists could reliably predict market crashes or booms, wouldn't they all be relaxing on private islands by now?

Part of the strangeness comes from [emergence](https://en.wikipedia.org/wiki/Emergence). Our "economy" isn't designed; it bubbles up from billions of individuals making choices for their own benefit. These choices, sensible in isolation, can collectively create outcomes nobody intended—like the 2008 Global Financial Crisis, where rational individual decisions around mortgage-backed securities snowballed into systemic collapse.[^1] Economics relies heavily on statistics to find patterns in this complex human behavior, making it closer to understanding group psychology than decoding the laws of physics.

Emergence is a fascinating phenomenon where simple interactions create complex patterns not apparent in the individual components. It's why predicting stock market bubbles, viral trends, or even the long-term effects of new technologies remains incredibly difficult—no central planner is pulling the strings. Honestly, sometimes economics feels less like physics and more like trying to read goat entrails, just with more spreadsheets.

## Economic Models: A Matter of Perspective

There are countless economic models, and each carries the fingerprints of its creator's worldview. Every theory has a political slant, tangled up with social values. Should we tax the rich? Support the poor? Let markets run wild, or regulate them? These aren't just economic questions; they're ethical ones, deeply intertwined with how we believe society should function.

John Maynard Keynes and Friedrich Hayek had famously opposing views. Keynes advocated for active government spending during downturns (Keynesian economics) to manage demand and reduce unemployment, influencing post-Depression and post-2008 recovery efforts. Hayek, championing the Austrian School, warned that such intervention distorts market signals and leads to inefficiency and loss of freedom, ideas that gained prominence during the deregulation trends of the late 20th century.[^2] Their debate continues to shape policy today, highlighting the fundamental tension between stability and liberty in economic management.

China offers a fascinating real-world puzzle. Its blend of state control and aggressive capitalism defies Western economic textbooks, which often insist such a hybrid shouldn't work efficiently. Yet, China has lifted hundreds of millions out of poverty through massive infrastructure projects, special economic zones attracting foreign investment, and strategic integration into global trade.[^3] It's a stark reminder that economic "success" depends on your definition—and that neat theories don't always capture messy reality.

Speaking about China as a success story is considered heresy by Western orthodox. And yet, without China, the world would be a much poorer place, and we wouldn't have any iPhones.

## The Economy as a Heat Engine

<div>
<div id="heat-engine-animation-container" class="w-full h-[400px] my-1 relative rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800">
  <div id="heat-engine-animation" class="w-full h-full"></div>
  <div id="heat-engine-loading" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400 font-sans">Loading Animation...</div>
</div>
<figcaption class="w-full text-sm text-gray-500 dark:text-gray-400 italic mt-2">
  I asked ChatGPT to hallucinate a heat engine for me, and this is what it came up with after 20 attempts. A visual metaphor for transforming energy, or something so advanced that it's beyond our feeble human comprehension?
</figcaption>
</div>

So, how can we better grasp this complex, emergent beast? One useful, if unconventional, lens is thermodynamics: viewing the economy as a [heat engine](https://en.wikipedia.org/wiki/Heat_engine).

In thermodynamics, a heat engine converts thermal energy into mechanical work by exploiting temperature differences. Think of the steam engine that powered the Industrial Revolution—literally a heat engine transforming coal's thermal energy into the mechanical force that built factories and laid railroads.[^4]

Similarly, an economy transforms inputs—energy, resources, labour, knowledge—into outputs: goods, services, and (ideally) human well-being.

The parallels are striking:

- **Energy Inputs:** Heat engines need fuel (like coal or gas). Economies need energy (fossil fuels, renewables), raw materials, human effort (labour), and ingenuity (knowledge).
- **Efficiency Constraints:** Heat engines can never be 100% efficient due to the Second Law of Thermodynamics—some energy is always lost as waste heat. Economies face their own limits: diminishing returns, transaction costs, bureaucratic friction, and imperfect information. This inefficiency was noted by William Stanley Jevons in 1865; he observed that making coal use *more* efficient paradoxically led to *greater* overall coal consumption as the technology became more widespread—a phenomenon now called the Jevons Paradox.[^5] We see this today: more fuel-efficient cars haven't drastically cut total fuel use because we drive more or buy larger vehicles. Similarly, energy-efficient data centers haven't stopped the overall energy consumption of computing from soaring due to rising demand for cloud services and AI.
- **Work Output:** A heat engine produces mechanical work (moving a piston, turning a wheel). An economy produces tangible goods, intangible services, infrastructure, and, hopefully, improved quality of life.
- **Waste Generation:** Both systems inevitably produce waste. Heat engines release waste heat and exhaust gases. Economies generate pollution, deplete non-renewable resources, create garbage, and incur social costs like inequality or stress.
- **Gradients and Flows:** Both operate based on differences. Heat engines rely on temperature gradients. Economies thrive on differences in prices, knowledge, resource availability, technological access, and economic opportunity across regions and individuals.

This heat engine metaphor helps explain why endless exponential economic growth on a finite planet is likely a physical impossibility—it would eventually violate the laws of thermodynamics, demanding infinite energy inputs or generating infinite waste. It also underscores why improving efficiency and minimizing waste are critical for any notion of sustainable development.

*Disclaimer: The heat engine model is often considered a fringe perspective in mainstream economics, which tends to focus more on monetary flows and market mechanisms than physical constraints. It's a useful lens, but not a dominant theory.*

## The Unseen Hand (and Foot) of Emergence

Emergent behavior is crucial here. We can model individual rational choices, but predicting the collective behavior of crowds—whether in markets or societies—is notoriously difficult. Think of stock market bubbles like the infamous Dutch Tulip Mania in the 1630s, where speculative fervor drove the price of some tulip bulbs higher than houses before the market crashed spectacularly.[^6] Or consider viral social media trends or sudden shifts in consumer preferences—complex, unpredictable patterns erupting from simple individual interactions, no central planner required.

Adam Smith's "invisible hand" is essentially a metaphor for *positive* emergence: how individual self-interest, guided by market competition, can inadvertently lead to collective benefits like efficient resource allocation and innovation. What Smith perhaps didn't emphasize as strongly is that emergence is neutral—it's a property of all complex systems. The *same* mechanism of self-interested actions aggregating can just as easily lead to *negative* outcomes: environmental degradation (the tragedy of the commons), widening inequality, market failures, or systemic financial risks.

The heat engine metaphor, by focusing on physical flows and energy transformations, helps account for these real-world constraints and consequences—the "waste heat" of economic activity—that purely abstract market models might overlook.

## Win-Win, Win-Lose, or Lose-Lose? The Engine's Output

Viewing the economy through the heat engine lens, where energy flows and transforms, helps clarify the nature of economic transactions. Ideally, free markets foster **win-win** exchanges where both parties benefit. In reality? The picture is far murkier. Many interactions feel like **win-lose**, some genuinely achieve win-win, and unfortunately, plenty end up **lose-lose**, especially when we factor in the hidden costs—the "waste heat"—of environmental damage or social disruption that standard GDP figures ignore.

Consider a typical job: You provide labour, your employer pays you. Ostensibly win-win. But if the value generated by your labour significantly exceeds your compensation, it starts looking more like a win (employer) - lose (employee) scenario from a value-capture perspective. Much of the capitalist system relies on generating surplus value from labour and capital investments. When this surplus is reinvested or distributed, stock prices rise, and the economy "grows"—at least in monetary terms.

But what about the immense value GDP completely overlooks? Parenting, caring for elderly relatives, volunteering, maintaining open-source software, or simply helping a neighbor—these are often profoundly **win-win** activities essential for societal cohesion and well-being, yet they don't register as "economic growth" because little or no money changes hands. This unpaid care work, disproportionately performed by women globally, is estimated to be worth around $11 trillion annually if it were compensated—about 9% of global GDP![^9] Yet, it remains largely invisible in standard economic measures.

The heat engine perspective forces us to ask: what "work output" truly matters? Is it just monetary exchange, or should we consider the broader impact on human and ecological well-being?

- **Win-win example:** Microfinance initiatives providing small loans to entrepreneurs in developing countries can empower individuals (borrower wins) while generating returns for the lender and stimulating local economies (lender/community wins).
- **Win-lose example:** Predatory lending practices trap borrowers in cycles of debt (borrower loses) while generating profits for the lender (lender wins). Historically, colonial resource extraction overwhelmingly benefited colonizing powers at the expense of colonized populations.
- **Lose-lose example:** Arms races drain national resources that could be used for development or social programs (both sides lose potential benefits) while increasing global insecurity. Trade wars, like the U.S.-China tariff escalations, often result in higher prices for consumers and disrupted supply chains in both countries.[^8]

## The Second Law and the Hard Limits to Growth

The Second Law of Thermodynamics is perhaps the most relevant physical principle here. It states that in any energy conversion, some energy is inevitably dispersed as unusable waste heat, and the total entropy (a measure of disorder or randomness) of an isolated system tends to increase over time.

For our economic heat engine, this isn't just abstract physics; it imposes hard limits. It means the economy, reliant on transforming finite energy and resources, is fundamentally *dissipative*. It constantly "runs down" natural capital unless new, high-quality energy and materials are fed in. Perpetual, exponential growth on a finite planet doesn't just seem difficult; it likely defies fundamental physical laws. No technological leap can achieve 100% efficiency in energy or material use; waste and dispersal are unavoidable consequences of activity. This echoes the warnings from studies like the 1972 "Limits to Growth" report, which modeled the potential clashes between infinite growth aspirations and finite planetary resources.[^10]

Furthermore, the Law of Conservation of Energy (the First Law) reminds us that energy cannot be created or destroyed, only transformed. The concentrated energy in fossil fuels, formed over millions of years, is finite. Once burned, its usable form is gone, transformed into heat and gases. While the sun provides vast amounts of incoming energy—more strikes the Earth each hour than humanity consumes in a year—capturing and converting it into useful forms at the scale required to replace fossil fuels remains a monumental technological and economic challenge.[^11]

## What is Economic Value, Really?

In the heat engine model, "value" isn't just monetary. It's tied to the useful work performed by harnessing energy and transforming materials, relative to the energy consumed and waste produced. Technology can improve the *efficiency* of this conversion—getting more useful output (better products, improved health, more leisure time) per unit of energy or resource input—but only up to thermodynamic limits.

This reframes the economic goal: perhaps it shouldn't solely be about maximizing GDP (the sheer volume of monetary transactions), but about maximizing *useful work* and human well-being while minimizing resource depletion and waste generation (improving thermodynamic efficiency). The accessibility of dense energy sources like fossil fuels has driven incredible economic expansion, but the associated "waste heat"—climate change, pollution—highlights the costs of prioritizing throughput over true efficiency and sustainability.

## The Future: Navigating by Thermodynamics?

Where do we go from here? It's hard to say. We often act as if we've conquered nature, forgetting we are utterly embedded within its physical systems. We're still learning—often the hard way—how to manage our collective activities sustainably on this finite planet.

My hunch? We'll likely keep pushing the boundaries until physical or ecological limits force a more significant reckoning. Hopefully, perspectives like the economic heat engine analogy—even if imperfect—can help us navigate that future more wisely. Recognizing that true prosperity isn't just about endless accumulation, but about efficient, equitable, and sustainable well-being, might be the crucial shift needed. The story of Easter Island (Rapa Nui), while complex, serves as a potent reminder. While recent research suggests introduced diseases and external factors played a larger role in its societal changes than previously thought, the challenges of managing resources on an isolated island remain a relevant parable for our planetary situation.[^12]

Thinking about economics as more than just money—as flows of energy and matter subject to unyielding physical laws—is a challenging but potentially vital shift in perspective for the 21st century. And I like the vibes.

[^1]: Federal Reserve History essay detailing the causes and events of the 2007-09 financial crisis. <https://www.federalreservehistory.org/essays/financial-crisis-of-2007-09>
[^2]: Economist article explaining the fundamental disagreements between Keynesian and Austrian economic thought. <https://www.economist.com/schools-brief/2016/08/04/the-great-debate> (See also research on Hayek's influence on Thatcher/Reagan era policies).
[^3]: World Bank overview of China's economy, noting significant poverty reduction and unique development model. <https://www.worldbank.org/en/country/china/overview>
[^4]: Britannica entry on the steam engine and its role in the Industrial Revolution. <https://www.britannica.com/technology/steam-engine>
[^5]: Scientific American article explaining the Jevons Paradox. <https://www.scientificamerican.com/article/what-is-the-jevons-paradox/> (Modern examples added based on web search).
[^6]: Investopedia article on the Dutch Tulip Mania. <https://www.investopedia.com/terms/t/tulipmania.asp> (Note: Modern scholarship suggests its broader economic impact might be overstated).
[^8]: Peterson Institute for International Economics analysis of US-China trade war impacts. <https://www.piie.com/research/piie-charts/us-china-trade-war-tariffs-date-chart>
[^9]: Oxfam report/UN Women data estimating the global economic value of unpaid care work (approx. $11 trillion or 9% of global GDP). See: <https://www.oxfam.org/en/press-releases/women-do-12-trillion-unpaid-care-work-year-new-oxfam-report> and UN Women data portals.
[^10]: Club of Rome page discussing the 'Limits to Growth' report. <https://www.clubofrome.org/publication/the-limits-to-growth/>
[^11]: Data on solar energy potential often cited by NREL and other energy research institutions. The specific "hour vs. year" claim is widely quoted but precise sourcing varies. <https://www.nrel.gov/research/re-solar.html>
[^12]: Recent anthropological and archaeological research complicates the "ecocide" narrative for Easter Island, emphasizing resilience and external factors like disease post-European contact. See summaries in journals like *Nature* or *Antiquity*. Original reference points to a general article: <https://www.scientificamerican.com/article/the-lessons-of-easter-island/>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.175.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.175.0/examples/jsm/"
  }
}
</script>
<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

if (document.readyState === 'loading') {
  window.addEventListener('DOMContentLoaded', initSteamEngine);
} else {
  initSteamEngine();
}

function initSteamEngine() {
  const container = document.getElementById('heat-engine-animation');
  const loadingIndicator = document.getElementById('heat-engine-loading');
  if (!container) return;
  if (loadingIndicator) loadingIndicator.style.display = 'none';

  // --- Theme Colors ---
  const themeColors = {
    dark: {
      background: '#181c20',
      neon1: '#00fff7',
      neon2: '#ff00e6',
      neon3: '#ffe600',
      metal: '#6b7683',
      accent: '#323843',
      steam: '#e0e0e0',
    },
    light: {
      background: '#f0f0f0',
      neon1: '#00b7c6',
      neon2: '#c600b7',
      neon3: '#b7c600',
      metal: '#b0b0b0',
      accent: '#e0e0e0',
      steam: '#444444',
    }
  };
  let currentTheme = document.documentElement.classList.contains('dark') ? themeColors.dark : themeColors.light;

  // --- Scene Setup ---
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(currentTheme.background);

  // --- Camera ---
  const camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 100);
  camera.position.set(7, 5, 10);
  camera.lookAt(0, 1, 0);

  // --- Renderer ---
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(container.clientWidth, container.clientHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.shadowMap.enabled = true;
  container.appendChild(renderer.domElement);

  // --- Controls ---
  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.08;
  controls.target.set(0, 1, 0);
  controls.minDistance = 4;
  controls.maxDistance = 20;
  controls.maxPolarAngle = Math.PI / 1.7;
  controls.update();

  // --- Lighting ---
  scene.add(new THREE.AmbientLight(currentTheme.metal, 0.5));
  const dirLight = new THREE.DirectionalLight(0xffffff, 0.7);
  dirLight.position.set(8, 12, 10);
  dirLight.castShadow = true;
  scene.add(dirLight);
  // Neon accent lights
  const neon1 = new THREE.PointLight(currentTheme.neon1, 1.5, 20);
  neon1.position.set(-3, 4, 4);
  scene.add(neon1);
  const neon2 = new THREE.PointLight(currentTheme.neon2, 1.5, 20);
  neon2.position.set(3, 4, -4);
  scene.add(neon2);

  // --- Materials ---
  const metalMat = new THREE.MeshStandardMaterial({ color: currentTheme.metal, metalness: 1.0, roughness: 0.18 });
  const accentMat = new THREE.MeshStandardMaterial({ color: currentTheme.accent, metalness: 0.5, roughness: 0.7 });
  const neonMat1 = new THREE.MeshStandardMaterial({ color: 0x000000, emissive: new THREE.Color(currentTheme.neon1), emissiveIntensity: 2.5 });
  const neonMat2 = new THREE.MeshStandardMaterial({ color: 0x000000, emissive: new THREE.Color(currentTheme.neon2), emissiveIntensity: 2.5 });
  const neonMat3 = new THREE.MeshStandardMaterial({ color: 0x000000, emissive: new THREE.Color(currentTheme.neon3), emissiveIntensity: 2.0 });

  // --- Engine Group ---
  const engine = new THREE.Group();
  scene.add(engine);

  // --- Base ---
  const base = new THREE.Mesh(new THREE.BoxGeometry(8, 0.5, 3), accentMat);
  base.position.y = -0.25;
  base.receiveShadow = true;
  engine.add(base);

  // --- Cylinder ---
  const cylinderLength = 4.0;
  const cylinderRadius = 0.6;
  const cylinder = new THREE.Mesh(new THREE.CylinderGeometry(cylinderRadius, cylinderRadius, cylinderLength, 32), metalMat);
  cylinder.position.set(0, 1.2, 0);
  cylinder.rotation.z = Math.PI / 2;
  cylinder.castShadow = true;
  engine.add(cylinder);
  // Neon ring at each end
  for (const sign of [-1, 1]) {
    const ring = new THREE.Mesh(new THREE.TorusGeometry(cylinderRadius + 0.05, 0.07, 16, 60), neonMat1);
    ring.position.set(sign * cylinderLength / 2, 1.2, 0);
    ring.rotation.y = Math.PI / 2;
    engine.add(ring);
  }

  // --- Piston ---
  const pistonLength = 0.7;
  const piston = new THREE.Mesh(new THREE.CylinderGeometry(cylinderRadius * 0.95, cylinderRadius * 0.95, pistonLength, 32), metalMat);
  piston.castShadow = true;
  engine.add(piston);

  // --- Flywheel ---
  const flywheelRadius = 2.0;
  const flywheelThickness = 0.3;
  const flywheel = new THREE.Mesh(new THREE.TorusGeometry(flywheelRadius, flywheelThickness, 32, 100), neonMat2);
  flywheel.position.set(cylinderLength / 2 + flywheelRadius + 0.2, 1.2, 0);
  flywheel.rotation.x = Math.PI / 2;
  flywheel.castShadow = true;
  engine.add(flywheel);
  // Flywheel hub
  const flywheelHub = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 0.5, 24), metalMat);
  flywheelHub.position.copy(flywheel.position);
  flywheelHub.rotation.x = Math.PI / 2;
  engine.add(flywheelHub);

  // --- Crank and Connecting Rod ---
  const crankRadius = 1.0;
  const crankCenter = flywheel.position.clone();
  // Crank pin (where rod attaches)
  const crankPin = new THREE.Mesh(new THREE.SphereGeometry(0.18, 16, 16), neonMat3);
  engine.add(crankPin);
  // Connecting rod
  const rod = new THREE.Mesh(new THREE.CylinderGeometry(0.13, 0.13, 3.2, 16), metalMat);
  rod.castShadow = true;
  engine.add(rod);
  // Piston rod (from piston to rod)
  const pistonRod = new THREE.Mesh(new THREE.CylinderGeometry(0.11, 0.11, 1.0, 12), metalMat);
  pistonRod.castShadow = true;
  engine.add(pistonRod);

  // --- Steam Puff (Particle) ---
  const steamGeo = new THREE.SphereGeometry(0.22, 12, 12);
  const steamMat = new THREE.MeshStandardMaterial({ color: currentTheme.steam, transparent: true, opacity: 0.5, emissive: new THREE.Color(currentTheme.steam), emissiveIntensity: 0.7 });
  const steam = new THREE.Mesh(steamGeo, steamMat);
  steam.visible = false;
  engine.add(steam);

  // --- Neon Pipes (decorative) ---
  const pipeCurve = new THREE.CatmullRomCurve3([
    new THREE.Vector3(-cylinderLength / 2, 0.7, -1.2),
    new THREE.Vector3(-cylinderLength / 2 - 1.2, 2.2, 0),
    new THREE.Vector3(-cylinderLength / 2, 1.2, 1.2)
  ]);
  const pipeGeo = new THREE.TubeGeometry(pipeCurve, 32, 0.09, 8, false);
  const pipe = new THREE.Mesh(pipeGeo, neonMat1);
  engine.add(pipe);

  // --- Steam Particle System ---
  const steamParticleCount = 40;
  const steamParticles = [];
  const steamParticleGeometry = new THREE.SphereGeometry(0.09, 8, 8);
  const steamParticleMaterial = new THREE.MeshStandardMaterial({
    color: currentTheme.steam,
    transparent: true,
    opacity: 0.45,
    emissive: new THREE.Color(currentTheme.steam),
    emissiveIntensity: 0.5,
    depthWrite: false
  });
  for (let i = 0; i < steamParticleCount; i++) {
    const mesh = new THREE.Mesh(steamParticleGeometry, steamParticleMaterial.clone());
    mesh.visible = false;
    engine.add(mesh);
    steamParticles.push({ mesh, age: 0, life: 0, velocity: new THREE.Vector3() });
  }

  // --- Animation State ---
  let flywheelAngle = 0;
  const pistonTravel = cylinderLength - pistonLength - 0.4;

  // --- Animation Loop ---
  const clock = new THREE.Clock();
  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    const elapsed = clock.getElapsedTime();
    flywheelAngle = -elapsed * 2.0;
    // Crank pin position (rotates on flywheel)
    const crankPinPos = crankCenter.clone().add(new THREE.Vector3(
      Math.cos(flywheelAngle) * crankRadius,
      Math.sin(flywheelAngle) * crankRadius,
      0
    ));
    crankPin.position.copy(crankPinPos);
    // Piston position (project crank pin onto cylinder axis)
    const pistonX = crankPinPos.x - flywheelRadius - cylinderLength / 2 - 0.2;
    piston.position.set(pistonX, 1.2, 0);
    // Connecting rod: from crank pin to piston
    const rodVec = crankPinPos.clone().sub(new THREE.Vector3(pistonX, 1.2, 0));
    const rodLen = rodVec.length();
    rod.position.copy(new THREE.Vector3((pistonX + crankPinPos.x) / 2, 1.2, 0));
    rod.scale.set(1, rodLen / 3.2, 1);
    rod.lookAt(crankPinPos);
    rod.rotateX(Math.PI / 2);
    // Piston rod: from piston to inside of cylinder
    pistonRod.position.set((pistonX - cylinderLength / 2) / 2, 1.2, 0);
    pistonRod.scale.set(1, Math.abs(pistonX - (-cylinderLength / 2)) / 1.0, 1);
    pistonRod.lookAt(new THREE.Vector3(pistonX, 1.2, 0));
    pistonRod.rotateX(Math.PI / 2);
    // Steam puff: emit at end of piston stroke
    if (Math.abs(Math.sin(flywheelAngle)) > 0.98) {
      steam.visible = true;
      steam.position.set(pistonX - 0.5, 1.2, 0);
      steam.material.opacity = 0.5 - 0.5 * Math.abs(Math.cos(elapsed * 6));
      // Emit a new steam particle
      for (let i = 0; i < steamParticles.length; i++) {
        const p = steamParticles[i];
        if (!p.mesh.visible) {
          p.mesh.position.set(pistonX - 0.5, 1.2, 0);
          p.velocity.set(
            (Math.random() - 0.5) * 0.12,
            0.18 + Math.random() * 0.12,
            (Math.random() - 0.5) * 0.12
          );
          p.age = 0;
          p.life = 0.9 + Math.random() * 0.5;
          p.mesh.material.opacity = 0.45;
          p.mesh.visible = true;
          break;
        }
      }
    } else {
      steam.visible = false;
    }
    // Animate steam particles
    for (let i = 0; i < steamParticles.length; i++) {
      const p = steamParticles[i];
      if (p.mesh.visible) {
        p.mesh.position.add(p.velocity);
        p.velocity.y += 0.008; // upward acceleration
        p.mesh.material.opacity *= 0.97;
        p.age += clock.getDelta();
        if (p.age > p.life || p.mesh.material.opacity < 0.05) {
          p.mesh.visible = false;
        }
      }
    }
    // Flywheel rotation
    flywheel.rotation.z = flywheelAngle;
    renderer.render(scene, camera);
  }
  animate();

  // --- Theme Switching ---
  function updateTheme() {
    currentTheme = document.documentElement.classList.contains('dark') ? themeColors.dark : themeColors.light;
    scene.background.set(currentTheme.background);
    metalMat.color.set(currentTheme.metal);
    accentMat.color.set(currentTheme.accent);
    neonMat1.emissive.set(currentTheme.neon1);
    neonMat2.emissive.set(currentTheme.neon2);
    neonMat3.emissive.set(currentTheme.neon3);
    steamMat.color.set(currentTheme.steam);
    steamMat.emissive.set(currentTheme.steam);
    neon1.color.set(currentTheme.neon1);
    neon2.color.set(currentTheme.neon2);
  }
  const observer = new MutationObserver((mutationsList) => {
    for (let mutation of mutationsList) {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        updateTheme();
        break;
      }
    }
  });
  observer.observe(document.documentElement, { attributes: true });

  // --- Handle Resizing ---
  function onWindowResize() {
    camera.aspect = container.clientWidth / container.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.clientWidth, container.clientHeight);
  }
  window.addEventListener('resize', onWindowResize);
  updateTheme();
}
</script>
